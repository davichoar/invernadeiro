{% extends "app/base_site.html" %}
{% block title %} Estadisticas {% endblock title %}

{% block stylesheets %}
  {{ block.super }}
  <link href="/static/vendors/pnotify/dist/pnotify.css" rel="stylesheet">
  <link href="/static/vendors/pnotify/dist/pnotify.buttons.css" rel="stylesheet">
  <link href="/static/vendors/pnotify/dist/pnotify.nonblock.css" rel="stylesheet">
{% endblock stylesheets %}

{% block content %}
<div class="right_col" role="main">
    <div class="">
      <div class="page-title">
        <div class="title_left">
          <h3>Estadisticas</h3>
        </div>

      </div>
      <div class="clearfix"></div>

      <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
          <div class="x_panel">
            <div class="x_title">
              <h2>Invernadero</h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">
              <div class="col-md-6 col-sm-12 col-xs-12">
                <h4>Consumo de Energía</h3>
                <div class="form-group">
                  <label for="sel1">Periodo:</label>
                  <select class="form-control" id="sel1" onchange="updateLineChart()">
                    <option value=5>Ultimas 5 mediciones</option>
                    <option value=10>Ultimas 10 mediciones</option>
                  </select>
                </div>
                <canvas id='energyLineChart'></canvas>
              </div>
              <div class="col-md-6 col-sm-12 col-xs-12">
                <h4>Nivel del tanque de agua</h3>
                <div class="form-group">
                  <label for="sel2">Periodo:</label>
                  <select class="form-control" id="sel2" onchange="updateBarChart()">
                    <option value=5>Ultimas 5 mediciones</option>
                    <option value=10>Ultimas 10 mediciones</option>
                  </select>
                </div>
                <canvas id='waterBarChart'></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row"> 
        <div class="col-md-12 col-sm-12 col-xs-12">
          <div class="x_panel">
            <div class="x_title">
              <h2>Componentes</h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">
              <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">
                <div class="form-group">
                  <label for="zona">Zona:</label>
                  <select class="form-control" id="zona" onchange="">
                    <option value=5>Ultimas 5 mediciones</option>
                    <option value=10>Ultimas 10 mediciones</option>
                  </select>
                </div>
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12 hidden">
                <div class="form-group">
                  <label for="modulo">Modulo:</label>
                  <select class="form-control" id="modulo" onchange="">
                    <option value=5>Ultimas 5 mediciones</option>
                    <option value=10>Ultimas 10 mediciones</option>
                  </select>
                </div>
              </div>  
              <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12 hidden">
              <div class="form-group">
                <label for="planta">Planta:</label>
                <select class="form-control" id="planta" onchange="">
                  <option value=5>Ultimas 5 mediciones</option>
                  <option value=10>Ultimas 10 mediciones</option>
                </select>
              </div>
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12 hidden">
                  <div class="form-group">
                    <label for="condicion">Condición:</label>
                    <select class="form-control" id="condicion" onchange="">
                      <option value=5>Ultimas 5 mediciones</option>
                      <option value=10>Ultimas 10 mediciones</option>
                    </select>
                  </div>
                  </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block javascripts %}
  {{ block.super }}

  <script src="/static/vendors/Chart.js/dist/Chart.min.js"></script>

  <script type="text/javascript">

    var labels = {{labels|safe}}
    var energy_data = {{energy|safe}}
    var water_data = {{water|safe}}

    var energyLineChart
    var waterBarChart

    var energy_data_chart = {
      labels: labels.slice(0,5),
      datasets: [
        {
          label: "Consumo de energía",
          backgroundColor: "rgba(38, 185, 154, 0.31)",
          borderColor: "rgba(38, 185, 154, 0.7)",
          pointBorderColor: "rgba(38, 185, 154, 0.7)",
          pointBackgroundColor: "rgba(38, 185, 154, 0.7)",
          pointHoverBackgroundColor: "#fff",
          pointHoverBorderColor: "rgba(220,220,220,1)",
          pointBorderWidth: 1,
          lineTension: 0,
          data: energy_data.slice(0,5)
        }
      ]
    }

    var water_data_chart = {
      labels: labels.slice(0,5),
      datasets: [
        {
          label: "Nivel del tanque de agua",
          backgroundColor: "rgba(115, 135, 156, 0.8)",
          pointBorderWidth: 1,
          data: water_data.slice(0,5)
        }
      ]
    }

    function setLineChart(data){
      var ctx = document.getElementById("energyLineChart")
      energyLineChart = new Chart(ctx, {
        type: 'line',
        data: data,
        options: {
          scales: {
            yAxes: [{
              ticks: { 
                beginAtZero: true
              }
            }]
          }
        }
      });
    }

    function setBarChart(data){
      var ctx = document.getElementById("waterBarChart")
      waterBarChart = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
          scales: {
            yAxes: [{
              ticks: { 
                beginAtZero: true
              }
            }]
          }
        }
      });
    }

    function updateLineChart(){
      let data_range = $('#sel1').val() 
      energyLineChart.data.labels = labels.slice(10 - data_range, 10)
      energyLineChart.data.datasets[0].data = energy_data.slice(10 - data_range, 10)
      energyLineChart.update()
    }

    function updateBarChart(){
      let data_range = $('#sel2').val()
      waterBarChart.data.labels = labels.slice(10 - data_range, 10)
      waterBarChart.data.datasets[0].data = water_data.slice(10 - data_range, 10)
      waterBarChart.update()
    }

    $(document).ready(function (){
      setLineChart(energy_data_chart)
      setBarChart(water_data_chart)
    })
  
  </script>

{% endblock javascripts %}